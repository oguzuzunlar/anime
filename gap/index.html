<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>GAP Analiz - KalÄ±cÄ± & Bilgilendirici Sistem</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --primary: #8b5cf6;
            --accent: #f59e0b;
            --neon-purple: #d8b4fe;
            --glass-bg: rgba(15, 23, 42, 0.6);
            --glass-border: rgba(216, 180, 254, 0.2);
        }

        body {
            margin: 0; padding: 0;
            background-color: #050505;
            font-family: 'Segoe UI', system-ui, sans-serif;
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
            overflow-y: auto;
        }

        canvas#matrixCanvas { position: fixed; top: 0; left: 0; z-index: 1; width: 100%; height: 100%; }

        .main-app {
            position: relative; z-index: 10;
            display: grid;
            grid-template-columns: 420px 1fr;
            min-height: 100vh;
            padding: 20px; gap: 20px;
            box-sizing: border-box;
        }

        /* RESPONSIVE AYARLAR */
        @media (max-width: 1100px) {
            .main-app {
                grid-template-columns: 1fr;
                padding: 15px;
            }
            .panel {
                max-width: 600px;
                margin: 0 auto;
                width: 100%;
                box-sizing: border-box;
            }
            .chart-wrap {
                min-height: 400px;
            }
        }

        @media (max-width: 600px) {
            .main-app { padding: 10px; gap: 10px; }
            .panel { padding: 15px; border-radius: 15px; }
            h1 { font-size: 18px; }
            input { font-size: 20px; padding: 10px; }
            .math-res { font-size: 30px; }
        }

        .panel {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 25px; 
            padding: 20px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(15px);
            display: flex; flex-direction: column;
        }

        h1 { color: var(--accent); margin: 0 0 15px 0; text-align: center; font-size: 20px; letter-spacing: 2px; text-transform: uppercase; font-weight: 900; }

        /* KISITLAR PANELÄ° */
        .constraints-vigo {
            background: rgba(0, 0, 0, 0.3);
            border-left: 4px solid var(--primary);
            border-radius: 12px; padding: 12px;
            margin-bottom: 20px;
        }
        .constraints-vigo h3 { margin: 0 0 5px 0; font-size: 11px; color: var(--neon-purple); text-transform: uppercase; letter-spacing: 1px; }
        .constraints-vigo p { margin: 3px 0; font-size: 14px; font-weight: 600; color: #e2e8f0; }
        .constraints-vigo b { color: var(--accent); font-family: monospace; }

        /* Girdi AlanlarÄ± */
        .input-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; }
        .input-unit label { display: block; margin-bottom: 5px; font-size: 11px; color: #94a3b8; }
        input {
            width: 100%; padding: 12px;
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid var(--primary);
            color: #4ade80; font-size: 24px; font-weight: bold;
            border-radius: 12px; box-sizing: border-box; text-align: center;
            outline: none; transition: 0.3s;
        }
        input:focus { border-color: #fff; box-shadow: 0 0 15px var(--primary); }
        
        button {
            width: 100%; padding: 15px;
            background: linear-gradient(135deg, var(--primary), #6d28d9);
            color: white; font-weight: bold; border: none; border-radius: 12px;
            cursor: pointer; font-size: 15px; transition: 0.3s;
            text-transform: uppercase; margin-bottom: 10px;
        }
        button:hover { transform: translateY(-2px); filter: brightness(1.2); }

        /* Veri YÃ¶netim ButonlarÄ± */
        .data-controls { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
        .btn-small { padding: 8px; font-size: 11px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); color: #cbd5e1; }
        .btn-reset { background: rgba(239, 68, 68, 0.15); border-color: rgba(239, 68, 68, 0.4); color: #f87171; }

        .formula-card {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px; padding: 15px; margin: 10px 0;
            text-align: center; border: 1px dashed var(--primary);
        }
        .math-res { font-size: 38px; font-weight: 900; color: #fff; text-shadow: 0 0 15px var(--accent); }

        #status-display {
            padding: 12px; border-radius: 10px; text-align: center;
            font-weight: 900; font-size: 17px; margin-top: auto;
            text-transform: uppercase;
        }
        .prime-st { background: rgba(34, 197, 94, 0.2); color: #4ade80; border: 1px solid #4ade80; }
        .semi-st { background: rgba(245, 158, 11, 0.2); color: #fbbf24; border: 1px solid #fbbf24; }
        .comp-st { background: rgba(239, 68, 68, 0.2); color: #f87171; border: 1px solid #f87171; }
        .warn-st { background: rgba(255, 255, 255, 0.05); border: 1px dashed #fff; color: #fff; }
        
        .chart-wrap { flex-grow: 1; position: relative; }

        /* YENÄ° SAYAÃ‡ PANELÄ° */
        .stats-dashboard {
            background: rgba(139, 92, 246, 0.1);
            border: 1px solid var(--glass-border);
            border-radius: 15px; padding: 15px;
            margin-top: 15px; display: grid;
            grid-template-columns: 1fr 1fr; gap: 10px;
        }
        .stat-item { text-align: center; }
        .stat-label { font-size: 10px; color: #94a3b8; text-transform: uppercase; margin-bottom: 5px; }
        .stat-value { font-size: 18px; font-weight: 900; color: #fff; }
        .expectation-box {
            grid-column: span 2; border-top: 1px solid rgba(255,255,255,0.1);
            padding-top: 10px; margin-top: 5px; text-align: center;
        }
        .exp-val { color: var(--accent); font-family: monospace; font-weight: bold; }

        .sound-controls {
            display: flex; gap: 10px; margin-bottom: 10px; justify-content: center;
        }
        .sound-btn {
            background: rgba(255, 255, 255, 0.1); border: 1px solid var(--glass-border);
            color: white; padding: 5px 10px; border-radius: 8px; cursor: pointer; font-size: 12px;
        }
        .sound-btn.active { border-color: var(--accent); color: var(--accent); box-shadow: 0 0 10px var(--accent); }
    </style>
</head>
<body>

    <canvas id="matrixCanvas"></canvas>

    <div class="main-app">
        <!-- SOL PANEL -->
        <div class="panel">
            <h1>GAP CANLI DENEYÄ°</h1>

            <!-- KISITLAR ALANI -->
            <div class="constraints-vigo">
                <h3>Sistem KÄ±sÄ±tlarÄ±</h3>
                <p>â€¢ Ebob(x, y) = <b>1</b></p>
                <p>â€¢ AralÄ±k: <b>x < y < 2x</b></p>
            </div>

            <div class="input-grid">
                <div class="input-unit">
                    <label>X PARAMETRESÄ°</label>
                    <input type="number" id="inputX" placeholder="x" autocomplete="off">
                </div>
                <div class="input-unit">
                    <label>Y PARAMETRESÄ°</label>
                    <input type="number" id="inputY" placeholder="y" autocomplete="off">
                </div>
            </div>

            <button class="btn-small" style="background: rgba(245, 158, 11, 0.15); border-color: rgba(245, 158, 11, 0.4); color: var(--accent); margin-top: -5px; margin-bottom: 15px;" onclick="randomizeY()">RASTGELE Y SEÃ‡ (KISITLARA UYGUN)</button>

            <div class="sound-controls">
                <button id="bgMusicBtn" class="sound-btn" onclick="toggleMusic()">ðŸŽµ MÃœZÄ°K: KAPALI</button>
                <button id="sfxBtn" class="sound-btn active" onclick="toggleSFX()">ðŸ”Š SES: AÃ‡IK</button>
            </div>
            
            <button onclick="runGAP()">ALGORÄ°TMAYI Ã‡ALIÅžTIR</button>

            <div class="formula-card">
                <div id="live-math" style="color: var(--neon-purple); font-family: monospace; font-size: 14px;">S = yÂ² + xy - xÂ²</div>
                <div id="res-val" class="math-res">?</div>
            </div>

            <!-- Veri YÃ¶netimi -->
            <div class="data-controls">
                <button class="btn-small" onclick="exportJSON()">VERÄ°LERÄ° Ä°NDÄ°R</button>
                <button class="btn-small" onclick="document.getElementById('fileInput').click()">DOSYADAN YÃœKLE</button>
                <input type="file" id="fileInput" style="display:none" onchange="importJSON(event)">
            </div>
            <button class="btn-small btn-reset" onclick="resetAllData()">HAFIZAYI TEMÄ°ZLE</button>

            <!-- OlasÄ±lÄ±ksal vs Deterministik SayaÃ§ -->
            <div class="stats-dashboard">
                <div class="stat-item">
                    <div class="stat-label">Toplam Deneme</div>
                    <div id="stat-total" class="stat-value">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Asal Bulundu</div>
                    <div id="stat-primes" class="stat-value" style="color: #4ade80;">0</div>
                </div>
                <div class="expectation-box">
                    <div class="stat-label">Asal SayÄ± Teoremi Beklentisi (PNT)</div>
                    <div class="stat-value"><span id="stat-exp" class="exp-val">0.00</span> <span style="font-size: 11px; color: #94a3b8;">ADET</span></div>
                    <div id="stat-ratio" style="font-size: 12px; color: #d8b4fe; margin-top: 5px; font-weight: bold;">BaÅŸarÄ± OranÄ±: 0.0x</div>
                </div>
            </div>

            <div id="status-display">SÄ°STEM HAZIR</div>
        </div>

        <!-- SAÄž PANEL -->
        <div class="panel">
            <h1 style="color: white; margin-bottom: 5px;">CanlÄ± Veri Ä°statistikleri</h1>
            <div class="chart-wrap">
                <canvas id="mainChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        // --- SES SÄ°STEMÄ° (SES DOSYALARI) ---
        let isSFXEnabled = true;
        let isMusicEnabled = false;
        
        // Ses dosyalarÄ±nÄ± tanÄ±mla (Ã–nerilen: Pixabay veya Freesound'dan .mp3 formatÄ±nda indirin)
        const sounds = {
            prime: new Audio('prime.mp3'),      // Ã–neri: "Futuristic Success Chime"
            semi: new Audio('semi.mp3'),        // Ã–neri: "Digital UI Click"
            composite: new Audio('composite.mp3'), // Ã–neri: "Deep Synth Fail"
            error: new Audio('error.mp3'),      // Ã–neri: "Access Denied / Alert"
            bgMusic: new Audio('background_music.mp3') // Ã–neri: "Cyberpunk Ambient Drone"
        };

        // Arka plan mÃ¼ziÄŸi ayarÄ±
        sounds.bgMusic.loop = true;
        sounds.bgMusic.volume = 0.4;

        function playSFX(type) {
            if (!isSFXEnabled) return;
            if (sounds[type]) {
                sounds[type].currentTime = 0; // BaÅŸa sar
                sounds[type].play().catch(e => console.log("Ses oynatÄ±lamadÄ±:", e));
            }
        }

        function toggleSFX() {
            isSFXEnabled = !isSFXEnabled;
            const btn = document.getElementById('sfxBtn');
            btn.innerText = isSFXEnabled ? "ðŸ”Š SES: AÃ‡IK" : "ðŸ”‡ SES: KAPALI";
            btn.classList.toggle('active', isSFXEnabled);
        }

        function toggleMusic() {
            isMusicEnabled = !isMusicEnabled;
            const btn = document.getElementById('bgMusicBtn');
            btn.innerText = isMusicEnabled ? "ðŸŽµ MÃœZÄ°K: Ã‡ALIYOR" : "ðŸŽµ MÃœZÄ°K: KAPALI";
            btn.classList.toggle('active', isMusicEnabled);

            if (isMusicEnabled) {
                sounds.bgMusic.play().catch(e => {
                    console.log("MÃ¼zik oynatÄ±lamadÄ±:", e);
                    isMusicEnabled = false;
                    btn.innerText = "ðŸŽµ MÃœZÄ°K: KAPALI";
                    btn.classList.remove('active');
                });
            } else {
                sounds.bgMusic.pause();
            }
        }

        // --- MATRIX ANÄ°MASYONU (Neon Mor Asal YaÄŸmuru) ---
        const canvas = document.getElementById('matrixCanvas');
        const ctx = canvas.getContext('2d');
        let width = canvas.width = window.innerWidth;
        let height = canvas.height = window.innerHeight;
        const primes = ['2', '3', '5', '7', '11', '13', '17', '19', '23', '29', '31', '37', '41', '43', '47', '53', '59', '61', '67', '71', '73', '79', '83', '89', '97'];
        const fontSize = 18;
        const columns = Math.floor(width / fontSize);
        const drops = Array(columns).fill(0).map(() => Math.random() * -100);

        function drawMatrix() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.06)';
            ctx.fillRect(0, 0, width, height);
            ctx.font = `bold ${fontSize}px monospace`;
            for (let i = 0; i < drops.length; i++) {
                const text = primes[Math.floor(Math.random() * primes.length)];
                const colors = ['#a855f7', '#d8b4fe', '#7e22ce', '#ffffff'];
                ctx.fillStyle = colors[Math.floor(Math.random() * colors.length)];
                
                const glow = Math.random() > 0.95;
                ctx.shadowBlur = glow ? 10 : 0;
                ctx.shadowColor = '#a855f7';

                ctx.fillText(text, i * fontSize, drops[i] * fontSize);
                if (drops[i] * fontSize > height && Math.random() > 0.985) drops[i] = 0;
                drops[i]++;
            }
            requestAnimationFrame(drawMatrix);
        }
        drawMatrix();

        // --- VERÄ° YÃ–NETÄ°MÄ° (LocalStorage & JSON) ---
        let db = {
            total: 0,
            counts: [0, 0, 0],
            history: [],
            expected_total: 0 // PNT beklentisi iÃ§in
        };

        function loadFromStorage() {
            const saved = localStorage.getItem('gap_analyzer_v3');
            if (saved) {
                db = JSON.parse(saved);
                if (db.expected_total === undefined) db.expected_total = 0;
                updateCharts();
            }
        }

        function saveToStorage() {
            localStorage.setItem('gap_analyzer_v3', JSON.stringify(db));
        }

        function resetAllData() {
            if(confirm("TÃ¼m kayÄ±tlÄ± verileriniz silinecek. Devam edilsin mi?")) {
                localStorage.removeItem('gap_analyzer_v3');
                location.reload();
            }
        }

        function exportJSON() {
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(db));
            const dlNode = document.createElement('a');
            dlNode.setAttribute("href", dataStr);
            dlNode.setAttribute("download", "gap_analiz_yedek.json");
            dlNode.click();
        }

        function importJSON(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    db = JSON.parse(e.target.result);
                    if (db.expected_total === undefined) db.expected_total = 0;
                    saveToStorage();
                    updateCharts();
                    alert("Veriler yÃ¼klendi!");
                } catch { alert("HatalÄ± dosya!"); }
            };
            reader.readAsText(file);
        }

        // --- MATEMATÄ°K VE GRAFÄ°K ---
        const gcd = (a, b) => b ? gcd(b, a % b) : a;
        const isPrime = n => {
            if (n < 2) return false;
            for (let i = 2; i <= Math.sqrt(n); i++) if (n % i === 0) return false;
            return true;
        };
        const isSemiPrime = n => {
            let count = 0, temp = n;
            for (let i = 2; i * i <= temp && count < 2; i++) {
                while (temp % i === 0) { temp /= i; count++; }
            }
            if (temp > 1) count++;
            return count === 2;
        };

        const chartCtx = document.getElementById('mainChart').getContext('2d');
        const myChart = new Chart(chartCtx, {
            type: 'bar',
            data: {
                labels: ['ASAL', 'YARI ASAL', 'DÄ°ÄžER'],
                datasets: [{
                    data: [0, 0, 0],
                    backgroundColor: ['#4ade80', '#fbbf24', '#f87171'],
                    borderRadius: 15
                }]
            },
            options: {
                maintainAspectRatio: false,
                layout: { padding: { top: 40 } },
                plugins: { legend: { display: false } },
                scales: { 
                    y: { beginAtZero: true, grace: '35%', grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#94a3b8' } },
                    x: { ticks: { color: '#fff', font: { weight: 'bold', size: 14 } } }
                }
            },
            plugins: [{
                id: 'lbl',
                afterDatasetsDraw(chart) {
                    const { ctx } = chart;
                    chart.data.datasets[0].data.forEach((val, i) => {
                        const { x, y } = chart.getDatasetMeta(0).data[i];
                        if(db.total === 0) return;
                        const perc = ((val / db.total) * 100).toFixed(1) + '%';
                        ctx.textAlign = 'center';
                        ctx.fillStyle = '#fff'; ctx.font = 'bold 13px sans-serif';
                        ctx.fillText(val + " Adet", x, y - 40);
                        ctx.fillStyle = '#FFD700'; ctx.font = '900 22px sans-serif';
                        ctx.fillText(perc, x, y - 12);
                    });
                }
            }]
        });

        function updateCharts() {
            myChart.data.datasets[0].data = db.counts;
            myChart.update();

            // SayaÃ§larÄ± gÃ¼ncelle
            document.getElementById('stat-total').innerText = db.total;
            document.getElementById('stat-primes').innerText = db.counts[0];
            document.getElementById('stat-exp').innerText = db.expected_total.toFixed(2);
            
            const ratio = db.expected_total > 0 ? (db.counts[0] / db.expected_total).toFixed(2) : "0.00";
            document.getElementById('stat-ratio').innerText = `BaÅŸarÄ± OranÄ±: ${ratio}x PNT Beklentisi`;
        }

        function randomizeY() {
            const xVal = parseInt(document.getElementById('inputX').value);
            if (!xVal || xVal < 2) {
                alert("Ã–nce geÃ§erli bir X deÄŸeri giriniz (x > 1).");
                playSFX('error');
                return;
            }

            const candidates = [];
            for (let y = xVal + 1; y < 2 * xVal; y++) {
                if (gcd(xVal, y) === 1) {
                    candidates.push(y);
                }
            }

            if (candidates.length > 0) {
                const randomY = candidates[Math.floor(Math.random() * candidates.length)];
                document.getElementById('inputY').value = randomY;
                playSFX('semi');
            } else {
                alert("Bu X deÄŸerine uygun bir Y bulunamadÄ±.");
            }
        }

        function triggerFireworks() {
            const duration = 3 * 1000;
            const animationEnd = Date.now() + duration;
            const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 1000 };

            function randomInRange(min, max) {
                return Math.random() * (max - min) + min;
            }

            const interval = setInterval(function() {
                const timeLeft = animationEnd - Date.now();

                if (timeLeft <= 0) {
                    return clearInterval(interval);
                }

                const particleCount = 50 * (timeLeft / duration);
                
                // Havai fiÅŸek patlamalarÄ±
                confetti(Object.assign({}, defaults, { 
                    particleCount, 
                    origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 },
                    colors: ['#8b5cf6', '#d8b4fe', '#f59e0b', '#ffffff']
                }));
                confetti(Object.assign({}, defaults, { 
                    particleCount, 
                    origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 },
                    colors: ['#8b5cf6', '#d8b4fe', '#f59e0b', '#ffffff']
                }));
            }, 250);
        }

        function runGAP() {
            const ix = document.getElementById('inputX');
            const iy = document.getElementById('inputY');
            const status = document.getElementById('status-display');
            const xVal = parseInt(ix.value);
            const yVal = parseInt(iy.value);

            if (!ix.value || !iy.value) return;

            // Kontroller
            if (!(xVal < yVal && yVal < 2*xVal) || gcd(xVal, yVal) !== 1) {
                status.className = 'comp-st'; status.innerText = "KISIT Ä°HLALÄ°!"; 
                playSFX('error');
                return;
            }
            if (db.history.some(h => h.x === xVal && h.y === yVal)) {
                status.className = 'warn-st'; status.innerText = "VERÄ° ZATEN MEVCUT!"; 
                playSFX('error');
                return;
            }

            const s = (yVal * yVal) + (xVal * yVal) - (xVal * xVal);
            document.getElementById('res-val').innerText = s;
            document.getElementById('live-math').innerText = `${yVal}Â² + (${xVal}Â·${yVal}) - ${xVal}Â²`;

            // PNT Beklentisi Hesapla: 1 / ln(s)
            const expectation = 1 / Math.log(s);
            db.expected_total += expectation;

            let idx = 2;
            if (isPrime(s)) { 
                idx = 0; 
                status.className = 'prime-st'; 
                status.innerText = "SONUÃ‡: ASAL âœ…";
                triggerFireworks();
                playSFX('prime');
            }
            else if (isSemiPrime(s)) { 
                idx = 1; 
                status.className = 'semi-st'; 
                status.innerText = "SONUÃ‡: YARI ASAL ðŸŸ§"; 
                playSFX('semi');
            }
            else { 
                status.className = 'comp-st'; 
                status.innerText = "SONUÃ‡: BÄ°LEÅžÄ°K âŒ"; 
                playSFX('composite');
            }

            db.total++;
            db.counts[idx]++;
            db.history.push({x: xVal, y: yVal, s: s, type: idx});
            
            saveToStorage();
            updateCharts();
            
            ix.value = ""; iy.value = ""; ix.focus();
        }

        loadFromStorage();
        window.onresize = () => { width = canvas.width = window.innerWidth; height = canvas.height = window.innerHeight; };
    </script>
</body>
</html>