<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>f: â„ â†’ â„, f(x) = xÂ² Fonksiyonu: AdÄ±m AdÄ±m DeÄŸerlendirme</title>
    <style>
        :root {
            --bg-color: #ecfdf5; --text-color: #1f2937; --card-bg: #ffffff; --card-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
            --primary-gradient: linear-gradient(135deg, #34d399 0%, #10b981 100%);
            --secondary-bg: #d1fae5; --secondary-text: #065f46;
            --border-color: #a7f3d0;
            --correct-bg: #f0fff4; --correct-border: #48bb78; --correct-text: #22543d;
            --incorrect-bg: #fff5f5; --incorrect-border: #f56565; --incorrect-text: #742a2a;
            --warning-bg: #f7fee7; --warning-border: #eab308; --warning-text: #854d0e;
            --grid-color: rgba(4, 120, 87, 0.15);
            --animation-bg: linear-gradient(to bottom, #ecfdf5 0%, #d1fae5 70%, #ffffff 100%);
        }
        .dark-mode {
            --bg-color: #0f172a;
            --text-color: #f1f5f9;
            --card-bg: #1e293b;
            --card-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            --secondary-bg: #334155;
            --secondary-text: #f1f5f9;
            --border-color: #475569;
            --correct-bg: #1e3a32;
            --correct-border: #22c55e;
            --correct-text: #bbf7d0;
            --incorrect-bg: #3c1917;
            --incorrect-border: #ef4444;
            --incorrect-text: #fecaca;
            --warning-bg: #451a03;
            --warning-border: #eab308;
            --warning-text: #fef3c7;
            --grid-color: rgba(255, 255, 255, 0.3);
            --animation-bg: #000;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg-color); color: var(--text-color); min-height: 100vh; transition: background-color 0.3s, color 0.3s; line-height: 1.6; }
        .container { max-width: 900px; margin: 20px auto; padding: 0 15px; }
        .header { background: var(--card-bg); border-radius: 15px; padding: 20px; text-align: center; margin-bottom: 20px; box-shadow: var(--card-shadow); position: relative; }
        .header h1 { margin-bottom: 10px; font-size: 1.8rem; }
        #theme-toggle { position: absolute; top: 15px; right: 15px; background: var(--secondary-bg); color: var(--secondary-text); border: none; width: 44px; height: 44px; border-radius: 50%; cursor: pointer; font-size: 1.5rem; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease; }
        .progress-bar { display: flex; justify-content: space-between; margin-bottom: 20px; background: var(--secondary-bg); border-radius: 10px; padding: 10px; }
        .progress-step { flex: 1; height: 8px; background: rgba(100, 100, 100, 0.2); margin: 0 2px; border-radius: 4px; transition: all 0.3s ease; }
        .progress-step.active { background: #48bb78; }
        .step { display: none; background: var(--card-bg); border-radius: 15px; padding: 30px; box-shadow: var(--card-shadow); animation: slideIn 0.5s ease; }
        .step.active { display: block; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        h2 { margin-bottom: 15px; font-size: 1.5rem; }
        h4 { margin-bottom: 10px; font-size: 1.1rem; color: var(--text-color); }
    .button { background: var(--primary-gradient); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-size: 1rem; font-weight: 600; transition: all 0.3s ease; margin: 5px; }
    .button:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(16, 185, 129, 0.35); }
        .button:disabled { opacity: 0.5; cursor: not-allowed; transform: none; box-shadow: none; }
        .button.secondary { background: var(--secondary-bg); color: var(--secondary-text); }
        .feedback { padding: 15px; border-radius: 8px; margin: 15px 0; font-weight: 500; text-align: center; }
        .feedback.success { background: var(--correct-bg); color: var(--correct-text); border: 1px solid var(--correct-border); }
        .feedback.wrong { background: var(--incorrect-bg); color: var(--incorrect-text); border: 1px solid var(--incorrect-border); }
        .feedback.warning { background: var(--warning-bg); color: var(--warning-text); border: 1px solid var(--warning-border); }
    .badge-score { background:linear-gradient(135deg,#10b981,#059669); color:#fff; display:inline-block; padding:8px 16px; border-radius:999px; font-size:1rem; font-weight:800; }
        .value-table { width: 100%; max-width: 250px; margin: 20px auto; border-collapse: separate; border-spacing: 0; text-align: center; font-size: 1.1rem; border: 1px solid var(--border-color); border-radius: 8px; overflow: hidden; }
        .value-table td, .value-table th { padding: 12px; border-bottom: 1px solid var(--border-color); }
        .value-table tr:last-child td { border-bottom: none; }
        .value-table th { background: var(--secondary-bg); font-weight: 600; }
        .value-table .table-label { background-color: var(--secondary-bg); font-weight: bold; }
        .value-table input { width: 80px; text-align: center; padding: 8px; border: 2px solid var(--border-color); border-radius: 6px; background-color: var(--bg-color); color: var(--text-color); font-size: 1rem; }
        #graph-container { text-align: center; margin: 20px auto; max-width: 600px; }
        #graph-canvas { border: 2px solid var(--border-color); border-radius: 8px; background: var(--bg-color); cursor: crosshair; width: 100%; height: auto; }
        #points-to-plot { margin-top: 20px; padding: 15px; background: var(--secondary-bg); border-radius: 8px; text-align: center; }
        #points-to-plot h4 { margin-bottom: 10px; font-size: 0.9rem; color: var(--secondary-text); }
        .point-tag { display: inline-block; font-family: monospace; font-size: 1rem; background: var(--card-bg); color: var(--text-color); padding: 5px 10px; border-radius: 5px; margin: 5px; border: 1px solid var(--border-color); transition: all 0.3s ease; }
        .point-tag.plotted { background: var(--correct-bg); color: var(--correct-text); text-decoration: line-through; opacity: 0.7; }
        .question { margin-bottom: 30px; }
        .question h3 { font-size: 1.1rem; margin-bottom: 15px; }
        .option { display: flex; align-items: center; padding: 12px; margin: 8px 0; background: var(--bg-color); border: 2px solid var(--border-color); border-radius: 8px; cursor: pointer; }
        .option.correct { border-color: var(--correct-border); background: var(--correct-bg); }
        .option.incorrect { border-color: var(--incorrect-border); background: var(--incorrect-bg); }
        .option input { margin-right: 12px; }
        .intro-list { list-style: none; padding: 0 20px; margin: 25px 0; text-align: left; max-width: 500px; margin-left: auto; margin-right: auto; }
        .intro-list li { padding-left: 1.5em; text-indent: -1.5em; margin-bottom: 12px; line-height: 1.6; }
    .intro-list li::before { content: 'â€¢'; color: #16a34a; font-weight: bold; display: inline-block; width: 1.5em; }
        .text-list { text-align: left; max-width: 600px; margin: 20px auto; padding-left: 20px; }
        .text-list li { margin-bottom: 10px; }
        .learn-more-btn { 
            background: linear-gradient(45deg, #34d399 0%, #10b981 100%); 
            color: white; border: none; padding: 15px 30px; border-radius: 25px; 
            cursor: pointer; font-size: 1.1rem; font-weight: 600; 
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.35); 
            transition: all 0.3s ease; margin: 20px 10px;
            position: relative; overflow: hidden;
        }
        .learn-more-btn::before {
            content: 'âœ¨'; position: absolute; left: -30px; top: 50%; 
            transform: translateY(-50%); font-size: 1.2rem;
            transition: all 0.3s ease;
        }
        .learn-more-btn:hover { 
            transform: translateY(-3px) scale(1.05); 
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.55);
        }
        .learn-more-btn:hover::before { left: 10px; }
        .modal { 
            display: none; position: fixed; z-index: 1000; left: 0; top: 0; 
            width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); 
            animation: fadeIn 0.3s ease;
        }
        .modal-content { 
            background-color: var(--card-bg); margin: 5% auto; padding: 30px; 
            border-radius: 15px; width: 90%; max-width: 700px; max-height: 80vh; 
            overflow-y: auto; box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: slideInDown 0.3s ease;
        }
        .modal-header { 
            display: flex; justify-content: space-between; align-items: center; 
            margin-bottom: 20px; border-bottom: 2px solid var(--border-color); 
            padding-bottom: 15px;
        }
        .close { 
            color: var(--secondary-text); font-size: 28px; font-weight: bold; 
            cursor: pointer; transition: color 0.3s;
        }
        .close:hover { color: var(--text-color); }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideInDown { from { transform: translateY(-50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .anim-info {
            color: #222;
            font-weight: 500;
        }
        .dark-mode .anim-info {
            color: #fff !important;
        }
        .anim-info-box {
            background: linear-gradient(135deg, #e3f2fd, #f3e5f5);
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #2196f3;
        }
        .dark-mode .anim-info-box {
            background: #000 !important;
            border-left: 4px solid #fff;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header ve Progress Bar -->
        <div class="header">
            <button id="theme-toggle" title="TemayÄ± DeÄŸiÅŸtir">â˜€ï¸</button>
            <h1 style="color: #10b981; font-weight: 800; margin-bottom: 0;">1. Basamak</h1>
            <h2 style="color: #10b981; font-weight: 700; margin-top: 8px;">Karesel Fonksiyonlar</h2>
            <div class="badge badge-score" style="margin-top: 10px;">Toplam Puan: <span id="total-score">0</span> / 10</div>
        </div>
        <div class="progress-bar"> <div class="progress-step" id="progress-1"></div><div class="progress-step" id="progress-2"></div><div class="progress-step" id="progress-3"></div><div class="progress-step" id="progress-4"></div><div class="progress-step" id="progress-5"></div> </div>
        
        <!-- AdÄ±m 0: GiriÅŸ -->
        <div class="step active" id="step-0">
            <div style="text-align: center;">
                <h2 style="color: #6a82fb;">Bilgilendirme</h2>
                <ul class="intro-list">
                    <li>Bu bir <strong>deÄŸerlendirme sÄ±navÄ±dÄ±r</strong>. SÄ±navÄ±n amacÄ±, karesel fonksiyonlar ile ilgili temel dÃ¼zeydeki bilgilerinizi Ã¶lÃ§mektir.</li>
                    <li>Ã–nce karesel fonksiyonlarÄ±n gerÃ§ek hayattaki kullanÄ±mÄ±nÄ±, Ã¶zellikle animasyonlarda nasÄ±l uygulandÄ±ÄŸÄ±nÄ± gÃ¶steren interaktif bir simÃ¼lasyon izleyeceksiniz.</li>
                    <li>SimÃ¼lasyon sonrasÄ±nda sÄ±nava geÃ§eceksiniz. SÄ±nav; tablo doldurma, grafik Ã§izimi ve Ã§oktan seÃ§meli sorulardan oluÅŸmaktadÄ±r.</li>
                    <li>Her bÃ¶lÃ¼mdeki sorularÄ± yanÄ±tlayarak ilerleyebilirsiniz.</li>
                    <li>SÄ±nav sonunda toplam puanÄ±nÄ±zÄ± ve her bÃ¶lÃ¼mden aldÄ±ÄŸÄ±nÄ±z puanlarÄ± gÃ¶rebileceksiniz.</li>
                    <li>Toplamda <strong>10 puan</strong> alabilirsiniz. (Tablo: 2 puan, Grafik: 3 puan, SÄ±nav: 5 puan)</li>
                    <li style="color: #d32f2f; font-weight: 600;">LÃ¼tfen dikkat: SÄ±navÄ± bitirdikten sonra tekrar Ã§Ã¶zme imkanÄ± bulunmamaktadÄ±r.</li>
                </ul>
                <button class="button" onclick="nextStep()">BaÅŸla</button>
            </div>
        </div>

        <!-- AdÄ±m 1: KeÅŸfet (YENÄ°LENMÄ°Å Ä°Ã‡ERÄ°K) -->
        <div class="step" id="step-1">
            <h2>ğŸ’¨ HÄ±zlanmanÄ±n MatematiÄŸi: YavaÅŸ BaÅŸla, HÄ±zlan!</h2>
            <p>Karesel fonksiyonlar, bilimde ve doÄŸada pek Ã§ok olgunun modellenmesinde temel bir yere sahiptir. Serbest dÃ¼ÅŸme hareketi, yansÄ±tÄ±cÄ± yÃ¼zeylerde Ä±ÅŸÄ±ÄŸÄ±n izlediÄŸi yol, kÃ¶prÃ¼ kablolarÄ±nÄ±n biÃ§imi ve atÄ±ÅŸ hareketinin yÃ¶rÃ¼ngesi gibi pek Ã§ok durum, karesel iliÅŸkilerle aÃ§Ä±klanÄ±r. Bu aÃ§Ä±dan, karesel fonksiyonlarÄ± anlamak; gÃ¶zlemlediÄŸimiz olaylarÄ±n neden ve sonuÃ§larÄ±nÄ± matematiksel olarak temellendirmemize yardÄ±mcÄ± olur.</p>

            <p>Animasyon tasarÄ±mÄ±nda da aynÄ± ilke geÃ§erlidir: Bir nesnenin <strong>yavaÅŸ baÅŸlayÄ±p giderek hÄ±zlanmasÄ±</strong> ve durmadan Ã¶nce <strong>yeniden yavaÅŸlamasÄ±</strong> â€œyavaÅŸ giriÅŸ â€“ yavaÅŸ Ã§Ä±kÄ±ÅŸ (ease-in/ease-out)â€ prensibiyle modellenir. Bu prensibin ardÄ±ndaki matematik, <strong>f(x) = xÂ²</strong> gibi karesel fonksiyonlarla ifade edilir ve hareketi daha gerÃ§ekÃ§i, daha anlaÅŸÄ±lÄ±r kÄ±lar.</p>

            <p class="anim-info-box">
                <strong>ğŸ¯</strong> <span class="anim-info">Bu Ã§alÄ±ÅŸmada odaklandÄ±ÄŸÄ±mÄ±z <strong>f(x) = xÂ²</strong> fonksiyonu, karesel fonksiyonlarÄ±n en temel Ã¶rneÄŸidir. AÅŸaÄŸÄ±daki deÄŸerlendirme; hem bu fonksiyonun <em>nicel</em> (tablo ve grafik Ã¼zerinden sayÄ±sal iliÅŸkiler) hem de <em>nitel</em> (ÅŸekil, yÃ¶nelme, tepe noktasÄ± ve deÄŸiÅŸim yÃ¶nÃ¼ gibi kavramsal Ã¶zellikler) boyutlarÄ±yla ilgili bilgi ve becerilerinizi Ã¶lÃ§meyi amaÃ§lamaktadÄ±r. Etkinlikleri tamamlarken aynÄ± zamanda â€œyavaÅŸ giriÅŸ â€“ yavaÅŸ Ã§Ä±kÄ±ÅŸâ€ hareketinin matematiksel temelini deneyimleyerek Ã¶ÄŸreneceksiniz.</span>
            </p>
            
            <div style="text-align:center; margin: 25px 0;">
                <h4>Ä°nteraktif SimÃ¼lasyon: ZÄ±playan Topun CanlÄ±lÄ±ÄŸÄ±</h4>
                <p style="margin-bottom: 15px; font-size: 0.9em; color: var(--secondary-text);">GerÃ§ekÃ§i ve sahte hareket arasÄ±ndaki farkÄ± kendin gÃ¶r! "Yer Ã‡ekimiyle DÃ¼ÅŸÃ¼r" seÃ§eneÄŸi, parabolik hÄ±zlanmanÄ±n (YavaÅŸ GiriÅŸ) gÃ¼cÃ¼nÃ¼ gÃ¶sterir.</p>
                <div id="animation-box" style="position: relative; max-width: 400px; height: 350px; background: var(--animation-bg); border: 2px solid var(--border-color); border-radius: 8px; margin: 10px auto; overflow: hidden; box-shadow: inset 0 2px 10px rgba(0,0,0,0.1);">
                    <!-- Referans Ã§izgileri - her %25'te bir -->
                    <div style="position: absolute; top: 25%; left: 0; right: 0; height: 1px; background: var(--grid-color); z-index: 1;"></div>
                    <div style="position: absolute; top: 50%; left: 0; right: 0; height: 1px; background: var(--grid-color); z-index: 1;"></div>
                    <div style="position: absolute; top: 75%; left: 0; right: 0; height: 1px; background: var(--grid-color); z-index: 1;"></div>
                    
                    <!-- Mesafe iÅŸaretleri -->
                    <div style="position: absolute; top: 25%; left: 5px; font-size: 11px; color: var(--text-color); font-weight: bold; background: var(--card-bg); padding: 1px 4px; border-radius: 3px; opacity: 0.9;">25%</div>
                    <div style="position: absolute; top: 50%; left: 5px; font-size: 11px; color: var(--text-color); font-weight: bold; background: var(--card-bg); padding: 1px 4px; border-radius: 3px; opacity: 0.9;">50%</div>
                    <div style="position: absolute; top: 75%; left: 5px; font-size: 11px; color: var(--text-color); font-weight: bold; background: var(--card-bg); padding: 1px 4px; border-radius: 3px; opacity: 0.9;">75%</div>
                    
                    <!-- HÄ±z gÃ¶stergesi -->
                    <div id="speed-indicator" style="position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.8); color: white; padding: 5px 10px; border-radius: 15px; font-size: 0.8em; z-index: 10; opacity: 0; transition: opacity 0.3s; border: 1px solid rgba(255,255,255,0.2);">
                        HÄ±z: <span id="speed-value">0</span> px/s
                    </div>
                    
                    <!-- Zaman gÃ¶stergesi -->
                    <div id="time-indicator" style="position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.8); color: white; padding: 5px 10px; border-radius: 15px; font-size: 0.8em; z-index: 10; opacity: 0; transition: opacity 0.3s; border: 1px solid rgba(255,255,255,0.2);">
                        â±ï¸ <span id="time-value">0</span>s
                    </div>
                    
                    <div id="ball" style="position: absolute; width: 40px; height: 40px; background: radial-gradient(circle at 10px 10px, #ff7e5f, #feb47b); border-radius: 50%; left: calc(50% -20px); top: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); z-index: 5;"></div>
                    <!-- KarÅŸÄ±laÅŸtÄ±rma modu toplarÄ± ve etiketleri -->
                    <div id="ball-linear" style="display:none; position: absolute; width: 40px; height: 40px; background: radial-gradient(circle at 10px 10px, #60a5fa, #2563eb); border-radius: 50%; left: calc(25% - 20px); top: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); z-index: 6;"></div>
                    <div id="ball-parabolic" style="display:none; position: absolute; width: 40px; height: 40px; background: radial-gradient(circle at 10px 10px, #fca5a5, #ef4444); border-radius: 50%; left: calc(75% - 20px); top: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); z-index: 6;"></div>
                    <div id="label-linear" style="display:none; position:absolute; top: 10px; left: calc(25% - 30px); background: rgba(0,0,0,0.6); color:#fff; font-size: 12px; padding: 3px 6px; border-radius: 10px; z-index:7;">Linear</div>
                    <div id="label-parabolic" style="display:none; position:absolute; top: 10px; left: calc(75% - 36px); background: rgba(0,0,0,0.6); color:#fff; font-size: 12px; padding: 3px 6px; border-radius: 10px; z-index:7;">DoÄŸal</div>
                </div>
                <div style="margin: 15px 0;">
                    <button class="button secondary" onclick="startAnimation('linear')" style="margin: 5px;">ğŸ¤– Sabit HÄ±zla DÃ¼ÅŸÃ¼r (Robotik)</button>
                    <button class="button" onclick="startAnimation('parabolic')" style="margin: 5px;">ğŸŒ Yer Ã‡ekimiyle DÃ¼ÅŸÃ¼r (DoÄŸal)</button>
                    <button class="button" onclick="startComparison()" style="margin: 5px; background: linear-gradient(135deg,#34d399,#059669);">â†”ï¸ KarÅŸÄ±laÅŸtÄ±rmalÄ± Oynat</button>
                </div>
                <p style="font-size: 0.85em; color: var(--secondary-text); margin-top: 10px; max-width: 380px; margin-left: auto; margin-right: auto;">
                    ğŸ’¡ <strong>FarklarÄ± GÃ¶zlemleyin:</strong><br>
                    ğŸ¤– <strong>Robotik:</strong> Sabit hÄ±z - her saniye aynÄ± mesafe (f(x) = x)<br>
                    ğŸŒ <strong>DoÄŸal:</strong> HÄ±zlanan hareket - baÅŸta yavaÅŸ, sonra hÄ±zla hÄ±zlanÄ±r (f(x) = xÂ²)<br>
                    <em>HÄ±z gÃ¶stergesindeki deÄŸiÅŸimi ve gÃ¶rsel efektleri karÅŸÄ±laÅŸtÄ±rÄ±n!</em>
                </p>
            </div>

            <div style="text-align: center; margin-top: 25px;">
                <button class="learn-more-btn" onclick="openModal()">ğŸ­ Daha FazlasÄ±nÄ± Ã–ÄŸren</button>
            </div>

            <div style="text-align: center; margin-top: 20px;"><button class="button" onclick="nextStep()">SÄ±nava BaÅŸla â¡ï¸</button></div>
        </div>

        <!-- AdÄ±m 2: Hesapla -->
        <div class="step" id="step-2"> <h2>Hesapla: DeÄŸerleri Bul (2 Puan)</h2> <p>f: â„ â†’ â„, f(x) = xÂ² fonksiyonu iÃ§in verilen x deÄŸerlerine karÅŸÄ±lÄ±k gelen y deÄŸerlerini hesaplayarak aÅŸaÄŸÄ±daki tabloyu doldurunuz.</p> <table class="value-table" id="value-table"> <thead> <tr> <th>x</th> <th>f: â„ â†’ â„, f(x) = xÂ²</th> </tr> </thead> <tbody> <tr> <td class="table-label">-3</td> <td><input type="number" data-x="-3"></td> </tr> <tr> <td class="table-label">-2</td> <td><input type="number" data-x="-2"></td> </tr> <tr> <td class="table-label">-1</td> <td><input type="number" data-x="-1"></td> </tr> <tr> <td class="table-label">0</td> <td><input type="number" data-x="0"></td> </tr> <tr> <td class="table-label">1</td> <td><input type="number" data-x="1"></td> </tr> <tr> <td class="table-label">2</td> <td><input type="number" data-x="2"></td> </tr> <tr> <td class="table-label">3</td> <td><input type="number" data-x="3"></td> </tr> </tbody> </table> <div class="feedback" id="table-feedback" style="display: none;"></div> <div style="text-align: center; margin-top: 20px;"> <button class="button secondary" id="check-table-btn" onclick="checkTable()">DeÄŸerleri Kontrol Et</button> <button class="button" id="to-graph-btn" onclick="nextStep()" disabled>GrafiÄŸi Ã‡izmeye BaÅŸla âœï¸</button> </div> </div>
        
        <!-- AdÄ±m 3: Uygula -->
        <div class="step" id="step-3"> <h2>Uygula: NoktalarÄ± Ä°ÅŸaretle (3 Puan)</h2> <p>HesapladÄ±ÄŸÄ±n noktalarÄ± koordinat dÃ¼zleminde doÄŸru yerlere tÄ±klayarak iÅŸaretleyiniz...</p> <div id="graph-container"> <canvas id="graph-canvas"></canvas> <div id="points-to-plot"><h4>Ä°ÅARETLENECEK NOKTALAR</h4></div> </div> <div class="feedback" id="graph-feedback" style="display: none;"></div> <div style="text-align: center; margin-top: 20px;"> <button class="button secondary" id="check-graph-btn" onclick="checkGraph()">NoktalarÄ± Kontrol Et</button> <button class="button" id="to-exam-btn" onclick="nextStep()" disabled>DeÄŸerlendirme SÄ±navÄ±na GeÃ§ ğŸ§ </button> </div> </div>

        <!-- AdÄ±m 4: DeÄŸerlendir -->
        <div class="step" id="step-4"> <h2>DeÄŸerlendir: Bilgini Test Et (5 Puan)</h2> <div id="question-container"></div> <div style="text-align: center; margin: 25px 0 10px;"><button class="button" id="finish-exam-btn" onclick="finishExam()">SÄ±navÄ± Bitir</button></div> </div>
        
        <!-- AdÄ±m 5: SonuÃ§ -->
        <div class="step" id="step-5">
            <div style="text-align: center;">
                <h2>ğŸ‰ SÄ±nav TamamlandÄ±!</h2>
                <div class="badge badge-score" style="font-size: 1.5rem; padding: 15px 25px; margin: 20px 0;">
                    Toplam PuanÄ±nÄ±z: <span id="final-total-score">0</span> / 10
                </div>
                <p id="score-breakdown" style="margin: 20px 0;"></p>
                <button class="button" onclick="showAnswers()" style="margin-top: 20px;">CevaplarÄ± GÃ¶r</button>
            </div>
            <div id="answers-section" style="display:none; margin-top:30px; text-align:left; max-width:600px; margin-left:auto; margin-right:auto;"></div>
        </div>
    </div>

    <!-- Modal - Daha Fazla Bilgi -->
    <div id="learnMoreModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 style="color: #667eea; margin: 0;">ğŸ­ Evrensel Bir Kural</h2>
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            <div class="modal-body">
                <p style="font-size: 1em; margin-bottom: 20px; color: var(--secondary-text);">Bu prensip, animasyona aÄŸÄ±rlÄ±k ve inandÄ±rÄ±cÄ±lÄ±k kattÄ±ÄŸÄ± iÃ§in neredeyse tÃ¼m Ã§izgi filmlerde kullanÄ±lÄ±r:</p>
                
                <div style="margin-bottom: 25px;">
                    <h4 style="color: #667eea; margin-bottom: 10px;">ğŸ± Tom ve Jerry:</h4>
                    <p>Tom, Jerry'yi kovalamaya baÅŸlamadan Ã¶nce olduÄŸu yerde bir an patinaj yapar. Bu hazÄ±rlÄ±k anÄ±, onun patlayÄ±cÄ± hÄ±zlanmasÄ± iÃ§in mÃ¼kemmel bir "YavaÅŸ GiriÅŸ" Ã¶rneÄŸidir.</p>
                </div>

                <div style="margin-bottom: 25px;">
                    <h4 style="color: #667eea; margin-bottom: 10px;">ğŸº Wile E. Coyote:</h4>
                    <p>UÃ§urumdan koÅŸtuktan sonra boÅŸlukta anÄ±nda dÃ¼ÅŸmez. Bir anlÄ±ÄŸÄ±na havada asÄ±lÄ± kalÄ±p kameraya bakmasÄ±, hareketinin komik bir "YavaÅŸ Ã‡Ä±kÄ±ÅŸ" ile sonlanmasÄ±dÄ±r.</p>
                </div>

                <div style="margin-bottom: 25px;">
                    <h4 style="color: #667eea; margin-bottom: 10px;">ğŸ¦” Sonic the Hedgehog:</h4>
                    <p>ÃœnlÃ¼ "Spin Dash" hareketi, hÄ±zla fÄ±rlamadan Ã¶nce olduÄŸu yerde dÃ¶nerek enerji biriktirmesidir. Bu, bariz bir "YavaÅŸ GiriÅŸ" tekniÄŸidir.</p>
                </div>

                <div style="margin-bottom: 25px;">
                    <h4 style="color: #667eea; margin-bottom: 10px;">ğŸ­ Speedy Gonzales:</h4>
                    <p>TÄ±pkÄ± Road Runner gibi, koÅŸmaya baÅŸlamadan Ã¶nce yerinde bir toz bulutu oluÅŸturarak hÄ±zlanmaya hazÄ±rlanÄ±r.</p>
                </div>

                <div style="background: var(--warning-bg); border: 1px solid var(--warning-border); border-radius: 8px; padding: 20px; margin-top: 25px;">
                    <h4 style="margin-bottom: 10px; text-align: center; color: var(--warning-text);">ğŸ¬ Animasyon KÃ¶ÅŸesi: GerÃ§ekÃ§iliÄŸin SÄ±rrÄ±</h4>
                    <p style="font-size: 0.9em; color: var(--warning-text);">Bir topu yere bÄ±raktÄ±ÄŸÄ±nÄ±zda sabit hÄ±zla mÄ± dÃ¼ÅŸer? HayÄ±r, yer Ã§ekimi sayesinde sÃ¼rekli hÄ±zlanÄ±r. AnimatÃ¶rler bu etkiyi yaratmak iÃ§in hareketin baÅŸlangÄ±cÄ±na daha Ã§ok, ortasÄ±na ise daha az resim karesi Ã§izerler. Bu karelerin zamana baÄŸlÄ± konumunu bir grafiÄŸe dÃ¶kersek, ortaya Ã§Ä±kan eÄŸri tam olarak bir parabol olur: <strong>Konum = k . ZamanÂ²</strong>. Ä°ÅŸte matematik, animasyona bÃ¶yle can verir!</p>
                </div>
            </div>
        </div>
    </div>

<script>
    let currentStep = 0; 
    let pointsToPlot = []; 
    let plottedPoints = []; 
    let tableScore = 0, graphScore = 0, quizScore = 0; 
    let tableTries = 0, graphTries = 0; 
    let g_ctx;
    
    // LMS'e puanÄ± gÃ¶nderme fonksiyonu
    function sendScoreToLMS(ogrenciPuani) {
        var result = {
            score: {
                max: 10,
                min: 0,
                raw: ogrenciPuani,
                scaled: ogrenciPuani / 10
            },
            completion: true,
            success: true,
            duration: "PT4.95S"
        };
        
        var lmsWindow = window.parent.document.getElementById("frmApp-0")?.contentWindow;
        
        if (lmsWindow?.onCompleted) {
            console.log("ğŸ“¡ LMS'e veri gÃ¶nderiyorum...");
            lmsWindow.onCompleted(result);
        } else {
            console.error("âŒ LMS'ye sinyal gÃ¶nderilemedi!");
        }
    }

    // MÃ¼zik efektleri iÃ§in fonksiyon
    function playMusicEffect(effectName) {
        try {
            const audio = new Audio(`${effectName}.mp3`);
            audio.volume = 0.3;
            audio.play().catch(e => console.log('MÃ¼zik Ã§alÄ±namadÄ±:', e));
        } catch (e) {
            console.log('MÃ¼zik efekti yÃ¼klenemedi:', effectName);
        }
    }
    
    const questions = [
        { type: 'multiple-select', q: '1. f: â„ â†’ â„, f(x) = xÂ² referans fonksiyonu iÃ§in aÅŸaÄŸÄ±daki eÅŸitliklerden hangileri doÄŸrudur?', options: ['f(-3) = 9', 'f(1/2) = 1/4', 'f(-1) = -1', 'f(2) = -4'], answer: [0, 1] }, 
        { type: 'multiple-select', q: '2. f: â„ â†’ â„, f(x) = xÂ² referans fonksiyonunun artan ve azalan olduÄŸu aralÄ±klar iÃ§in hangileri doÄŸrudur?', options: ['(-âˆ, 0) aralÄ±ÄŸÄ±nda artandÄ±r.', '(-âˆ, 0) aralÄ±ÄŸÄ±nda azalandÄ±r.', '(0, âˆ) aralÄ±ÄŸÄ±nda artandÄ±r.', '(0, âˆ) aralÄ±ÄŸÄ±nda azalandÄ±r.'], answer: [1, 2] }, 
        { type: 'multiple-select', q: '3. f: â„ â†’ â„, f(x) = xÂ² referans fonksiyonunun simetri Ã¶zellikleri iÃ§in hangileri doÄŸrudur?', options: ['GrafiÄŸi y eksenine gÃ¶re simetriktir.', 'Ã‡ift fonksiyondur.', 'GrafiÄŸi orijine gÃ¶re simetriktir.', 'Tek fonksiyondur.'], answer: [0, 1] }, 
        { type: 'multiple-select', q: '4. f: â„ â†’ â„, f(x) = xÂ² referans fonksiyonunun Ã¶zel noktalarÄ± ve deÄŸerleri iÃ§in hangileri doÄŸrudur?', options: ['Minimum deÄŸeri 0\'dÄ±r.', 'Tepe noktasÄ± (0, 0) koordinatÄ±dÄ±r.', 'Maksimum deÄŸeri yoktur.', 'Fonksiyonun sÄ±fÄ±rÄ± x=0 noktasÄ±dÄ±r.'], answer: [0, 1, 2, 3] }, 
        { type: 'multiple-select', q: '5. f: â„ â†’ â„, f(x) = xÂ² referans fonksiyonunun genel Ã¶zellikleri iÃ§in hangileri doÄŸrudur?', options: ['Bire bir fonksiyondur.', 'Bire bir fonksiyon deÄŸildir.', 'Ã–rten fonksiyondur.', 'Ã–rten fonksiyon deÄŸildir.'], answer: [1, 3] }
    ];

    document.addEventListener('DOMContentLoaded', () => { 
        loadExamQuestions(); 
        setupThemeToggle(); 
    });

    function loadExamQuestions() { 
        const container = document.getElementById('question-container'); 
        container.innerHTML = ''; 
        questions.forEach((item, index) => { 
            const qDiv = document.createElement('div'); 
            qDiv.className = 'question'; 
            let content = `<h3>${item.q}</h3>`; 
            item.options.forEach((opt, i) => { 
                content += `<label class="option"><input type="checkbox" name="q${index}" value="${i}"> ${opt}</label>`; 
            }); 
            qDiv.innerHTML = content; 
            container.appendChild(qDiv); 
        }); 
    }

    function finishExam() { 
        playMusicEffect('exam');
        let correctQuizAnswers = 0; 
        questions.forEach((q, index) => { 
            const checked = Array.from(document.querySelectorAll(`input[name="q${index}"]:checked`)).map(cb => parseInt(cb.value)); 
            const answer = q.answer; 
            if (checked.length === answer.length && checked.every(val => answer.includes(val))) { 
                correctQuizAnswers++; 
            } 
            document.querySelectorAll(`input[name="q${index}"]`).forEach(cb => { 
                const cbVal = parseInt(cb.value); 
                if(answer.includes(cbVal)) { 
                    cb.parentElement.classList.add('correct'); 
                } else if (cb.checked) { 
                    cb.parentElement.classList.add('incorrect'); 
                } 
                cb.disabled = true; 
            }); 
        }); 
        quizScore = correctQuizAnswers; 
        updateTotalScore(); 
        document.getElementById('finish-exam-btn').disabled = true; 
        playSound('complete'); 
        setTimeout(nextStep, 3000); 
    }

    function updateTotalScore() { 
        const total = tableScore + graphScore + quizScore; 
        document.getElementById('total-score').textContent = total; 
    }

    function checkTable() { 
        playMusicEffect('check');
        tableTries++; 
        const inputs = document.querySelectorAll('#value-table input'); 
        let correctCount = 0; 
        pointsToPlot = []; 
        inputs.forEach(input => { 
            const x = parseInt(input.dataset.x); 
            const correctY = x * x; 
            const userY = parseInt(input.value); 
            if (userY === correctY) { 
                input.classList.remove('incorrect'); 
                input.classList.add('correct'); 
                correctCount++; 
            } else { 
                input.classList.remove('correct'); 
                input.classList.add('incorrect'); 
            } 
        }); 
        if (correctCount === inputs.length) { 
            if (tableTries === 1) { 
                tableScore = 2; 
                showFeedback('table-feedback', 'success', 'Harika! Ä°lk denemede doÄŸru. +2 Puan kazandÄ±n.'); 
                playMusicEffect('success');
            } else { 
                tableScore = 1; 
                showFeedback('table-feedback', 'success', 'Ã‡ok gÃ¼zel! DÃ¼zeltmelerle baÅŸardÄ±n. +1 Puan kazandÄ±n.'); 
                playMusicEffect('success');
            } 
            playSound('complete'); 
            document.getElementById('to-graph-btn').disabled = false; 
            document.getElementById('check-table-btn').disabled = true; 
            inputs.forEach(input => input.disabled = true); 
        } else { 
            if (tableTries === 1) { 
                showFeedback('table-feedback', 'warning', `Dikkat! ${inputs.length - correctCount} hata var. Son bir deneme hakkÄ±n kaldÄ±!`); 
                playSound('error'); 
                playMusicEffect('error');
            } else { 
                tableScore = 0; 
                showFeedback('table-feedback', 'wrong', 'DoÄŸru cevaplar gÃ¶steriliyor. LÃ¼tfen incele. Bu aÅŸamadan puan alamadÄ±n.'); 
                inputs.forEach(input => { 
                    const x = parseInt(input.dataset.x); 
                    input.value = x * x; 
                    input.classList.remove('incorrect'); 
                    input.disabled = true; 
                }); 
                playSound('fail'); 
                playMusicEffect('fail');
                document.getElementById('to-graph-btn').disabled = false; 
                document.getElementById('check-table-btn').disabled = true; 
            } 
        } 
        inputs.forEach(input => { 
            pointsToPlot.push({x: parseInt(input.dataset.x), y: parseInt(input.value)}); 
        }); 
        updateTotalScore(); 
    }
    
    function checkGraph() { 
        playMusicEffect('check');
        graphTries++; 
        if (plottedPoints.length < pointsToPlot.length) { 
            if (graphTries === 1) { 
                showFeedback('graph-feedback', 'warning', `Eksik noktalar var. ${pointsToPlot.length} noktanÄ±n tamamÄ±nÄ± iÅŸaretlemelisin. Son hakkÄ±n!`); 
                playSound('error'); 
                playMusicEffect('error');
            } else { 
                graphScore = 0; 
                showFeedback('graph-feedback', 'wrong', 'DoÄŸru noktalar otomatik olarak iÅŸaretlendi. Bu aÅŸamadan puan alamadÄ±n.'); 
                plottedPoints = [...pointsToPlot]; 
                redrawGraph(); 
                document.getElementById('to-exam-btn').disabled = false; 
                document.getElementById('check-graph-btn').disabled = true; 
                if(g_ctx) g_ctx.canvas.style.cursor = 'default'; 
                playSound('fail'); 
                playMusicEffect('fail');
            } 
        } else { 
            if (graphTries === 1) { 
                graphScore = 3; 
                showFeedback('graph-feedback', 'success', 'MÃ¼kemmel! TÃ¼m noktalar ilk denemede doÄŸru. +3 Puan kazandÄ±n.'); 
                playMusicEffect('success');
            } else { 
                graphScore = 2; 
                showFeedback('graph-feedback', 'success', 'BaÅŸardÄ±n! DÃ¼zeltmelerle noktalarÄ± tamamladÄ±n. +2 Puan kazandÄ±n.'); 
                playMusicEffect('success');
            } 
            playSound('complete'); 
            redrawGraph(); 
            document.getElementById('to-exam-btn').disabled = false; 
            document.getElementById('check-graph-btn').disabled = true; 
            if(g_ctx) g_ctx.canvas.style.cursor = 'default'; 
        } 
        updateTotalScore(); 
    }

    let animationFrameId = null; 
    let indicatorHideTimeoutId = null; // HÄ±z/zaman etiketlerini gizleyen zamanlayÄ±cÄ±yÄ± takip eder

    function startAnimation(type) { 
        playMusicEffect('animation');
        if (animationFrameId) { 
            cancelAnimationFrame(animationFrameId);
            animationFrameId = null; 
        }
        // Ã–nceki gizleme zamanlayÄ±cÄ±sÄ± kaldÄ±ysa iptal et
        if (indicatorHideTimeoutId) {
            clearTimeout(indicatorHideTimeoutId);
            indicatorHideTimeoutId = null;
        }
        const ball = document.getElementById('ball'); 
        const speedIndicator = document.getElementById('speed-indicator');
        const speedValue = document.getElementById('speed-value');
        const timeIndicator = document.getElementById('time-indicator');
        const timeValue = document.getElementById('time-value');

        // GÃ¼venlik: Elemanlar yoksa Ã§Ä±k
        if (!ball) return;

        const startPosition = 10; 
        const endPosition = 280; 
        const distance = endPosition - startPosition; 
        const duration = 4000; // 4 saniye
        let startTime = null; 
        let lastPosition = startPosition;
        let lastTimestamp = null;
        
        // Topun baÅŸlangÄ±Ã§ pozisyonuna sÄ±fÄ±rla
        ball.style.top = `${startPosition}px`;
        ball.style.transform = 'scale(1)';
        ball.style.boxShadow = '0 4px 15px rgba(0,0,0,0.2)';
        ball.style.transition = '';
        
        // HÄ±z ve zaman gÃ¶stergelerini gÃ¶ster
        if (speedIndicator) speedIndicator.style.opacity = '1';
        if (timeIndicator) timeIndicator.style.opacity = '1';
        if (speedValue) speedValue.textContent = '0';
        if (timeValue) timeValue.textContent = '0.0';
        
        function animateFrame(timestamp) { 
            if (!startTime) startTime = timestamp; 
            const elapsed = timestamp - startTime; 
            const dt = lastTimestamp ? (timestamp - lastTimestamp) : 0;
            let progress = Math.min(elapsed / duration, 1); 
            let position; 
            let speedPxPerSec = 0;
            
            if (type === 'linear') { 
                // Sabit hÄ±z - doÄŸrusal hareket
                position = startPosition + distance * progress; 
                // GÃ¶lge ve boyut deÄŸiÅŸimi yok
                ball.style.transform = 'scale(1)';
                ball.style.boxShadow = '0 4px 15px rgba(0,0,0,0.2)';
                if (speedIndicator) speedIndicator.style.background = 'rgba(128, 128, 128, 0.8)'; // Gri - sabit
            } else {
                // VarsayÄ±lan: parabolik
                const easedProgress = Math.pow(progress, 2.4); // farkÄ± biraz daha artÄ±r
                position = startPosition + distance * easedProgress; 
                
                // Sadece gÃ¶lge efektleri - top boyutu sabit kalÄ±r
                const shadowIntensity = 0.2 + (progress * 0.7);
                const shadowSize = 4 + (progress * 25);
                ball.style.transform = 'scale(1)';
                ball.style.boxShadow = `0 ${shadowSize}px ${shadowSize * 2}px rgba(0,0,0,${shadowIntensity})`;
                if (speedIndicator) {
                    const intensity = Math.min(progress * 2, 1);
                    speedIndicator.style.background = `rgba(${255 * intensity}, ${200 * (1-intensity)}, 0, 0.9)`;
                }
            }

            // HÄ±zÄ± gerÃ§ek zamanlÄ± hesapla (px/s)
            if (dt > 0) {
                speedPxPerSec = Math.abs(position - lastPosition) / (dt / 1000);
            }
            if (speedValue) speedValue.textContent = String(Math.round(speedPxPerSec));
            if (timeValue) timeValue.textContent = (elapsed / 1000).toFixed(1);
            lastPosition = position;
            lastTimestamp = timestamp;
            
            ball.style.top = `${position}px`; 
            
            if (progress < 1) {
                animationFrameId = requestAnimationFrame(animateFrame); 
            } else {
                // Animasyon bittiÄŸinde
                indicatorHideTimeoutId = setTimeout(() => {
                    if (speedIndicator) speedIndicator.style.opacity = '0';
                    if (timeIndicator) timeIndicator.style.opacity = '0';
                    indicatorHideTimeoutId = null;
                }, 1200);
                
                // ZÄ±plama efekti
                if (type === 'linear') {
                    setTimeout(() => {
                        ball.style.transition = 'all 0.2s linear';
                        ball.style.top = `${endPosition - 20}px`;
                        setTimeout(() => {
                            ball.style.top = `${endPosition}px`;
                            setTimeout(() => { ball.style.transition = ''; }, 200);
                        }, 100);
                    }, 100);
                } else {
                    setTimeout(() => {
                        ball.style.transition = 'all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
                        ball.style.top = `${endPosition - 35}px`;
                        ball.style.boxShadow = '0 15px 30px rgba(0,0,0,0.3)';
                        setTimeout(() => {
                            ball.style.top = `${endPosition}px`;
                            ball.style.boxShadow = '0 4px 15px rgba(0,0,0,0.2)';
                            setTimeout(() => { ball.style.transition = ''; }, 400);
                        }, 200);
                    }, 100);
                }
            }
        } 
        playSound('advance'); 
        animationFrameId = requestAnimationFrame(animateFrame); 
    } 

    // KarÅŸÄ±laÅŸtÄ±rmalÄ± oynatma: aynÄ± anda linear ve parabolik
    function startComparison() {
        playMusicEffect('animation');
        // Ã–nceki animasyonu durdur ve gizleme zamanlayÄ±cÄ±sÄ±nÄ± iptal et
        if (animationFrameId) { cancelAnimationFrame(animationFrameId); animationFrameId = null; }
        if (indicatorHideTimeoutId) { clearTimeout(indicatorHideTimeoutId); indicatorHideTimeoutId = null; }

        const box = document.getElementById('animation-box');
        const bLin = document.getElementById('ball-linear');
        const bPar = document.getElementById('ball-parabolic');
        const lLin = document.getElementById('label-linear');
        const lPar = document.getElementById('label-parabolic');
        if (!box || !bLin || !bPar || !lLin || !lPar) return;

        // Ana topu gizle, iki topu gÃ¶ster
        const ball = document.getElementById('ball');
        if (ball) ball.style.display = 'none';
        bLin.style.display = 'block';
        bPar.style.display = 'block';
        lLin.style.display = 'block';
        lPar.style.display = 'block';

        const startPosition = 10;
        const endPosition = 280;
        const distance = endPosition - startPosition;
        const duration = 4500; // biraz daha uzun
        let startTime = null;

        // BaÅŸlangÄ±Ã§ durumlarÄ±
        bLin.style.top = `${startPosition}px`;
        bPar.style.top = `${startPosition}px`;
        bLin.style.transition = '';
        bPar.style.transition = '';
        bLin.style.boxShadow = '0 4px 15px rgba(0,0,0,0.2)';
        bPar.style.boxShadow = '0 4px 15px rgba(0,0,0,0.2)';

        function frame(t) {
            if (!startTime) startTime = t;
            const elapsed = t - startTime;
            const p = Math.min(elapsed / duration, 1);

            // Linear
            const posLin = startPosition + distance * p;
            bLin.style.top = `${posLin}px`;

            // Parabolic (biraz daha gÃ¼Ã§lÃ¼ easing)
            const eased = Math.pow(p, 2.5);
            const posPar = startPosition + distance * eased;
            // Parabolikte gÃ¶lge bÃ¼yÃ¼sÃ¼n, top sabit kalsÄ±n
            const shadowSize = 4 + (p * 25);
            const shadowIntensity = 0.2 + (p * 0.7);
            bPar.style.top = `${posPar}px`;
            bPar.style.boxShadow = `0 ${shadowSize}px ${shadowSize*2}px rgba(0,0,0,${shadowIntensity})`;

            if (p < 1) {
                animationFrameId = requestAnimationFrame(frame);
            } else {
                // ZÄ±plamalar
                setTimeout(() => {
                    bLin.style.transition = 'all 0.2s linear';
                    bLin.style.top = `${endPosition - 20}px`;
                    setTimeout(() => {
                        bLin.style.top = `${endPosition}px`;
                        setTimeout(() => { bLin.style.transition = ''; }, 200);
                    }, 100);
                }, 100);

                setTimeout(() => {
                    bPar.style.transition = 'all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
                    bPar.style.top = `${endPosition - 35}px`;
                    setTimeout(() => {
                        bPar.style.top = `${endPosition}px`;
                        setTimeout(() => { bPar.style.transition = ''; }, 300);
                    }, 200);
                }, 100);

                // Bitince eski duruma dÃ¶n
                setTimeout(() => {
                    bLin.style.display = 'none';
                    bPar.style.display = 'none';
                    lLin.style.display = 'none';
                    lPar.style.display = 'none';
                    if (ball) { ball.style.display = 'block'; ball.style.top = `${startPosition}px`; }
                }, 1500);
            }
        }

        animationFrameId = requestAnimationFrame(frame);
    }

    function redrawGraph() { 
        if (currentStep >= 3 && g_ctx) { 
            drawGraphContent(); 
            if (plottedPoints.length === pointsToPlot.length) { 
                drawFinalParabola(); 
            } 
        } 
    } 

    function initializeGraphCanvas() { 
        const container = document.getElementById('graph-container'); 
        try { 
            if (g_ctx) { 
                redrawGraph(); 
                return; 
            } 
            const canvas = document.getElementById('graph-canvas'); 
            if (!canvas || !canvas.getContext) throw new Error("Canvas desteklenmiyor."); 
            g_ctx = canvas.getContext('2d'); 
            canvas.width = Math.min(container.clientWidth, 600); 
            canvas.height = canvas.width; 
            const pointsList = document.getElementById('points-to-plot'); 
            pointsList.innerHTML = '<h4>Ä°ÅARETLENECEK NOKTALAR</h4>'; 
            pointsToPlot.forEach(p => { 
                const pointEl = document.createElement('span'); 
                pointEl.className = 'point-tag'; 
                pointEl.id = `p-${p.x}`; 
                pointEl.textContent = `(${p.x}, ${p.y})`; 
                pointsList.appendChild(pointEl); 
            }); 
            plottedPoints = []; 
            drawGraphContent(); 
            canvas.addEventListener('click', handleCanvasClick); 
        } catch (e) { 
            console.error("Grafik oluÅŸturulamadÄ±:", e); 
            container.innerHTML = `<div class="feedback wrong">Grafik yÃ¼klenirken bir sorun oluÅŸtu. <button class="button" onclick="initializeGraphCanvas()">Tekrar Dene</button></div>`; 
        } 
    } 

    function drawGraphContent() { 
        const w = g_ctx.canvas.width, h = g_ctx.canvas.height; 
        const margin = 30; 
        const centerX = w / 2, centerY = h - margin - 10; 
        const xRange = 8; 
        const yRange = 12; 
        const xUnit = (w - margin*2) / xRange; 
        const yUnit = (h - margin*2) / yRange; 
        g_ctx.clearRect(0, 0, w, h); 
        g_ctx.font = "12px Segoe UI"; 
        g_ctx.strokeStyle = getComputedStyle(document.body).getPropertyValue('--grid-color'); 
        g_ctx.lineWidth = 1; 
        g_ctx.beginPath(); 
        for (let i = -xRange/2; i <= xRange/2; i++) { 
            const cX = centerX + i * xUnit; 
            g_ctx.moveTo(cX, 0); 
            g_ctx.lineTo(cX, h); 
        } 
        for (let i = 0; i <= yRange; i++) { 
            const cY = centerY - i * yUnit; 
            g_ctx.moveTo(0, cY); 
            g_ctx.lineTo(w, cY); 
        } 
        g_ctx.stroke(); 
        g_ctx.strokeStyle = getComputedStyle(document.body).getPropertyValue('--secondary-text'); 
        g_ctx.fillStyle = getComputedStyle(document.body).getPropertyValue('--secondary-text'); 
        g_ctx.lineWidth = 2; 
        g_ctx.beginPath(); 
        drawArrow(g_ctx, 0, centerY, w, centerY, 10); 
        drawArrow(g_ctx, centerX, h, centerX, 0, 10); 
        g_ctx.stroke(); 
        g_ctx.fillStyle = getComputedStyle(document.body).getPropertyValue('--text-color'); 
        g_ctx.font = "bold 14px Segoe UI"; 
        g_ctx.fillText('O', centerX - 12, centerY + 15); 
        g_ctx.fillText('x', w - 15, centerY + 18); 
        g_ctx.fillText('y', centerX - 18, 15); 
        g_ctx.font = "12px Segoe UI"; 
        g_ctx.textAlign = 'center'; 
        g_ctx.textBaseline = 'top'; 
        for (let i = -xRange/2 + 1; i < xRange/2; i++) { 
            if (i === 0) continue; 
            g_ctx.fillText(i, centerX + i * xUnit, centerY + 5); 
        } 
        g_ctx.textAlign = 'right'; 
        g_ctx.textBaseline = 'middle'; 
        for (let i = 1; i <= yRange; i++) { 
            g_ctx.fillText(i, centerX - 5, centerY - i * yUnit); 
        } 
        plottedPoints.forEach(p => { 
            const cX = centerX + p.x * xUnit, cY = centerY - p.y * yUnit; 
            g_ctx.fillStyle = '#48bb78'; 
            g_ctx.beginPath(); 
            g_ctx.arc(cX, cY, 6, 0, 2 * Math.PI); 
            g_ctx.fill(); 
        }); 
    } 

    function drawArrow(ctx, fromX, fromY, toX, toY, headLength) { 
        ctx.moveTo(fromX, fromY); 
        ctx.lineTo(toX, toY); 
        let angle = Math.atan2(toY - fromY, toX - fromX); 
        ctx.moveTo(toX, toY); 
        ctx.lineTo(toX - headLength * Math.cos(angle - Math.PI / 6), toY - headLength * Math.sin(angle - Math.PI / 6)); 
        ctx.moveTo(toX, toY); 
        ctx.lineTo(toX - headLength * Math.cos(angle + Math.PI / 6), toY - headLength * Math.sin(angle + Math.PI / 6)); 
        angle = Math.atan2(fromY - toY, fromX - toX); 
        ctx.moveTo(fromX, fromY); 
        ctx.lineTo(fromX - headLength * Math.cos(angle - Math.PI / 6), fromY - headLength * Math.sin(angle - Math.PI / 6)); 
        ctx.moveTo(fromX, fromY); 
        ctx.lineTo(fromX - headLength * Math.cos(angle + Math.PI / 6), fromY - headLength * Math.sin(angle + Math.PI / 6)); 
    } 

    function handleCanvasClick(e) { 
        if (plottedPoints.length === pointsToPlot.length) return; 
        const rect = e.target.getBoundingClientRect(); 
        const clickX = e.clientX - rect.left, clickY = e.clientY - rect.top; 
        const w = g_ctx.canvas.width, h = g_ctx.canvas.height; 
        const margin = 30; 
        const centerX = w / 2, centerY = h - margin - 10; 
        const xRange = 8, yRange = 12; 
        const xUnit = (w - margin*2) / xRange, yUnit = (h - margin*2) / yRange; 
        const tolerance = 0.4; 
        const mathClickX = (clickX - centerX) / xUnit; 
        const mathClickY = (centerY - clickY) / yUnit; 
        for (const point of pointsToPlot) { 
            if (plottedPoints.find(p => p.x === point.x && p.y === point.y)) continue; 
            if (Math.abs(mathClickX - point.x) < tolerance && Math.abs(mathClickY - point.y) < tolerance) { 
                plottedPoints.push(point); 
                document.querySelector(`#p-${point.x}`).classList.add('plotted'); 
                redrawGraph(); 
                playSound('success'); 
                showFeedback('graph-feedback', 'success', `${plottedPoints.length}/${pointsToPlot.length} nokta iÅŸaretlendi.`); 
                return; 
            } 
        } 
        showFeedback('graph-feedback', 'wrong', 'HatalÄ± nokta! LÃ¼tfen listedeki noktalardan birini hedefle.'); 
        playSound('error');
    } 

    function drawFinalParabola() { 
        const w = g_ctx.canvas.width, h = g_ctx.canvas.height; 
        const margin = 30; 
        const centerX = w / 2, centerY = h - margin - 10; 
        const xRange = 8, yRange = 12; 
        const xUnit = (w - margin*2) / xRange, yUnit = (h - margin*2) / yRange; 
        g_ctx.strokeStyle = '#fc5c7d'; 
        g_ctx.lineWidth = 4; 
        g_ctx.beginPath(); 
        for (let i = -xRange/2; i <= xRange/2; i += 0.1) { 
            const x = centerX + i * xUnit; 
            const y = centerY - (i*i) * yUnit; 
            if (i === -xRange/2) g_ctx.moveTo(x, y); 
            else g_ctx.lineTo(x, y); 
        } 
        g_ctx.stroke(); 
    } 

    function setupThemeToggle() { 
        const toggle = document.getElementById('theme-toggle'); 
        toggle.addEventListener('click', () => { 
            document.body.classList.toggle('dark-mode'); 
            toggle.textContent = document.body.classList.contains('dark-mode') ? 'ğŸŒ™' : 'â˜€ï¸'; 
            if (currentStep >= 3) redrawGraph(); 
        }); 
    } 

    function showFeedback(id, type, msg) { 
        const el = document.getElementById(id); 
        el.className = `feedback ${type}`; 
        el.textContent = msg; 
        el.style.display = 'block'; 
    } 

    function playSound(type) { 
        try { 
            const a={'success':[523,0.1],'error':[207,0.2],'complete':[659,0.3],'advance':[440,0.1], 'fail':[164,0.4]};
            const [f,d]=a[type]; 
            const c=new(window.AudioContext||window.webkitAudioContext)();
            const o=c.createOscillator();
            const g=c.createGain();
            o.connect(g);
            g.connect(c.destination);
            o.frequency.value=f;
            o.type='sine';
            g.gain.setValueAtTime(0.1,c.currentTime);
            g.gain.exponentialRampToValueAtTime(0.001,c.currentTime+d);
            o.start(c.currentTime);
            o.stop(c.currentTime+d); 
        } catch (e) {} 
    } 

    function nextStep() { 
        playMusicEffect('step');
        if (currentStep > 0 && currentStep <= 5) { 
            document.getElementById(`progress-${currentStep}`).classList.add('active'); 
        } 
        if (currentStep < 5) { 
            document.getElementById(`step-${currentStep}`).classList.remove('active'); 
            currentStep++; 
            document.getElementById(`step-${currentStep}`).classList.add('active'); 
            if (currentStep === 3) initializeGraphCanvas(); 
            if (currentStep === 5) { 
                const total = tableScore + graphScore + quizScore; 
                document.getElementById('final-total-score').textContent = total; 
                document.getElementById('score-breakdown').innerHTML = `<strong>Puan DÃ¶kÃ¼mÃ¼:</strong> Tablo (${tableScore} puan), Grafik (${graphScore} puan), SÄ±nav (${quizScore} puan)`;
            } 
        } 
    }
    
    function showAnswers() {
        playMusicEffect('reveal');
        const totalScore = tableScore + graphScore + quizScore;
        
        try {
            sendScoreToLMS(totalScore);
        } catch (error) {
            console.error("LMS'e puan gÃ¶nderilirken hata oluÅŸtu:", error);
        }
        
        const answersDiv = document.getElementById('answers-section');
        answersDiv.innerHTML = '';
        answersDiv.innerHTML += '<h3>SÄ±nav YanÄ±tlarÄ±</h3>';
        questions.forEach((q, i) => {
            const checked = Array.from(document.querySelectorAll(`input[name='q${i}']:checked`)).map(cb => parseInt(cb.value));
            answersDiv.innerHTML += `<div style='margin-bottom:10px;'><strong>${q.q}</strong><br>`;
            answersDiv.innerHTML += '<strong>VerdiÄŸiniz YanÄ±tlar:</strong> ' + (checked.length ? checked.map(idx => q.options[idx]).join(' ') : 'YanÄ±t yok') + '<br>';
            answersDiv.innerHTML += '<strong>DoÄŸru YanÄ±tlar:</strong> ' + q.answer.map(idx => q.options[idx]).join(' ');
            answersDiv.innerHTML += '</div>';
        });
        answersDiv.style.display = 'block';
    }

    function openModal() {
        playMusicEffect('modal');
        document.getElementById('learnMoreModal').style.display = 'block';
        playSound('advance');
    }

    function closeModal() {
        document.getElementById('learnMoreModal').style.display = 'none';
    }

    // Modal dÄ±ÅŸÄ±na tÄ±klayÄ±nca kapat
    window.onclick = function(event) {
        const modal = document.getElementById('learnMoreModal');
        if (event.target == modal) {
            closeModal();
        }
    }
</script>
</body>
</html>